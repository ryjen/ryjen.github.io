box: digitallyseamless/nodejs-bower-grunt
build:
  steps:
    - wercker/npm-install@1.1.4
    - plasticine/bower-install@0.0.4
    - add-to-known_hosts:
        hostname: $GIT_DEPLOY_HOST
    - add-ssh-key:
        keyname: dokku
    - script:
        name: Initialize git submodules
        code: |
          git submodule update --init --recursive
          cd deploy
          git pull origin master
    - script:
        name: Build assets
        code: ./node_modules/.bin/brunch build
    - arjen/hugo-build:
        version: "1.12.0"
deploy:
  steps:
    - install-packages:
        packages: rsync
    - add-to-known_hosts:
        hostname: $GIT_DEPLOY_HOST
    - add-ssh-key:
        keyname: dokku
    - script:
        name: Synchronize deploy files
        code: ./sync_deploy
    - script:
        name: push to dokku
        code: |
          cd ./deploy
          git config user.email "info@ryan-jennings.net"
          git config user.name "$WERCKER_STARTED_BY"
          git config push.default simple
          git add -A .
          git commit -m "deploy from wercker ($WERCKER_BUILD_URL)"
          git push origin HEAD:master
