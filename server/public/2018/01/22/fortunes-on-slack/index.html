<!doctype html>
<html class="no-js" lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Fortunes on Slack</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="google-site-verification" content="jkdqcIgCmfBgfd8S0WbF3CqZ-TXSSayerVq4mqO0Fc0" />
<meta name="google-site-verification" content="Crk6W-ckoApRrOZrv23ngLwPPTbzjzfZ4AQPElgS0pw" />
<meta name="google-site-verification" content="Crk6W-ckoApRrOZrv23ngLwPPTbzjzfZ4AQPElgS0pw" />
<meta name="description" content="a namespace for technical and musical musings" />
<meta name="ROBOTS" CONTENT="INDEX, FOLLOW">
        
    
<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro" rel="stylesheet">
<link rel="stylesheet" href="/css/theme.min.css">



<link href="/css/app.min.css" rel="stylesheet">


 

    <meta name="generator" content="Hugo 0.40.1" />

</head>
<body>

<div id="background">
</div>



<div id="header" class="clearfix">
    
        <span id="menu-toggle"><i class="fa fa-bars"></i></span>
    <div class="container clearfix">
        <div id="brand">
	    <a href="/">
  <img src="/image/logo.svg" alt="logo" width="40" height="40" /> <span class="brand">coda.life</span>
</a>

        </div>
        <nav>
            
                <ul class="nav navbar-nav">
                    
                        <li class="nav-toggle blog">
                            <a href="/post">
                            
                            <i class="fa fa-rss"></i> 
                            
                            <span class="nav-name">blog</span>
                            </a>
                        </li>
                    
                        <li class="nav-toggle music">
                            <a href="/music">
                            
                            <i class="fa fa-music"></i> 
                            
                            <span class="nav-name">music</span>
                            </a>
                        </li>
                    
                        <li class="nav-toggle doodles">
                            <a href="/doodles">
                            
                            <i class="fa fa-paint-brush"></i> 
                            
                            <span class="nav-name">doodles</span>
                            </a>
                        </li>
                    
                        <li class="nav-toggle things">
                            <a href="/things">
                            
                            <i class="fa fa-object-ungroup"></i> 
                            
                            <span class="nav-name">things</span>
                            </a>
                        </li>
                    
                </ul>
            


            
                <ul class="nav navbar-icons">
                    
                        <li class="navbar-icon"><a href="/resume/"><i class="fa fa-file-o"></i></a></li>
                    
                        <li class="navbar-icon"><a href="mailto:ryan@coda.life"><i class="fa fa-envelope-o"></i></a></li>
                    
                        <li class="navbar-icon"><a href="https://github.com/ryjen/"><i class="fa fa-github"></i></a></li>
                    
                </ul>
            
        </nav>
    </div>
</div>

<div class="container">


<div id="main">

    <h1>Fortunes on Slack</h1>

    <div class="text-justify">

<p><a href="https://fortunes.micrantha.com">view the service homepage</a></p>

<h4 id="introduction">Introduction</h4>

<p>Have always enjoyed the <a href="https://en.wikipedia.org/wiki/Fortune_%28Unix%29">UNIX fortunes</a> program, ever since I was a wee <a href="https://en.wikipedia.org/wiki/Newbie">newbie</a>.  If you aren&rsquo;t familiar with it (sad), yes, its like a fortune cookie.</p>

<p>It can be more technical in nature but not always.  It also has poems, quotations, and if enabled - offensive content.</p>

<p>Often I would find a fortune I&rsquo;d like to share and pipe it to a snippet from the terminal.  There has to and must be a better way!</p>

<p>This time a Slack application has appeared on my radar as a target.</p>

<h4 id="man-the-sonar">Man the Sonar</h4>

<p>Cannot engage the target without some information.</p>

<p>The existing fortunes database will provide plenty of content.  Fortunately (no pun intended), I&rsquo;ve already extracted the legacy flat file storage system into SQL for another project.</p>

<p><code>TODO: add conversion to SQL details</code></p>

<p>Had to make a few changes, a link table here, few fields there, but the gist is I have a PostgreSQL initialization script of fortunes.</p>

<h4 id="cut-me-some-slack">Cut me some Slack</h4>

<p>Got the data (got the life), how does Slack care?</p>

<p>The user enters a slash command and Slack will send a torpedo to my server by means of an HTTP JSON post.</p>

<p>My server will then typically counter measure with what they call an &ldquo;Ephemeral Message&rdquo;.</p>

<p>The counter measure will have an attachment to give an option to make the message visible to the current channel (by means of another torpedo and counter measure).</p>

<p><code>TODO: detail more the key parts, json and oauth</code></p>

<h4 id="alright-captain-tell-me-about-your-ship">Alright Captain, Tell me About Your Ship</h4>

<p>First, say &ldquo;I was born on a pirate ship&rdquo; 5 times fast. OK, never mind.</p>

<p>This is a story about a gopher and a whale in a secure proxy.</p>

<p>In other words, I&rsquo;m just running golang, in a docker container, behind NGINX with lets-encrypt.</p>

<p><img src="/image/blog/architecture.png" alt="fortunes architecture" /></p>

<h4 id="ok-what-if-a-torpedo-hits">OK, What if a Torpedo Hits?</h4>

<p>Yeah, I don&rsquo;t think the world will be falling over itself to use the fortunes service, but if they do, I will start charging to spin up more droplets and a load balancer.</p>

<p>As I&rsquo;m using docker, switching to AWS Fargate is possible too with a Docker Compose file.</p>

<h4 id="for-the-code-or-gopher-geeks">For the Code or Gopher Geeks</h4>

<p>As most gophers already know, the beauty of go besides its concurrency is its simplicity and its awesome packages.</p>

<p>For HTTP is you really don&rsquo;t need anything.  The standard library is so simple yet so effective.  Your endpoints become functions, your functions become routed to paths, and you serve. The standard template packages work great for layouts in the endpoint functions.</p>

<p>The server has two restful API&rsquo;s - the standard API and the Slack API. Both use the same process of serializing from the database to JSON by typical means of attributed data models.</p>

<p><code>TODO: add some code architecture details</code></p>

<h4 id="conclusion">Conclusion</h4>

<p>Random fortune cookies are fun.  Slack is fun.  Golang is awesome.  Docker is pleasing.</p>

<p>Check out <a href="https://fortunes.micrantha.com">the final solution</a> page.</p>

<p><code>TODO: implement mobile apps</code></p>
</div>

</div>

</div>





<hr>

<div class="container">


    <div id="related">
        <h5>Related:</h5>

         <div class="card item bg-default clearfix">

    
    

      

    <p class="pull-right">February 19, 2018</p>
    <h4><a href="/2018/02/19/deploy-docker-registry-with-dokku/">Deploy Docker Registry with Dokku</a></h4>
    <h5>Put your own docker registry in a dokku app</h5>

     <span class="item-tag">docker</span>  <span class="item-tag">registry</span>  <span class="item-tag">dokku</span> 

</div>
 

    </div>


</div>



<hr>

<div class="container">

	
	  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "arg3" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	

</div>


</div>

<div id="footer">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-5084920929867043",
      enable_page_level_ads: true
    });
  </script>


<script type="text/javascript">
  var _paq = _paq || [];
   
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//analytics.micrantha.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>






<div class="center">
	&copy; all rights reserved, ryan jennings
</div>

</div>


<script src="/js/theme.min.js"></script>


<script src="/js/app.min.js"></script>


<script>hljs.initHighlightingOnLoad();</script>







</body>
</html>


