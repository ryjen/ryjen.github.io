<!doctype html><html class=no-js lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>c hacking: polymorphing 2</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=google-site-verification content="Crk6W-ckoApRrOZrv23ngLwPPTbzjzfZ4AQPElgS0pw"><meta name=description content="personal blog of an engineer, musician, and madman"><meta name=ROBOTS content="INDEX, FOLLOW"><link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,900&family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap" rel=stylesheet><link rel=stylesheet href=/css/theme.min.css><link href=/css/app.min.css rel=stylesheet><meta name=generator content="Hugo 0.79.0"></head><body><div id=header class=clearfix><div class="container clearfix"><div id=brand><a href=/><span class=brand>ryan jennings</span></a></div><div id=menu-toggle><i class="fas fa-bars"></i></div><nav><ul class="nav navbar-nav menu"><li class="nav-toggle blog"><a href=/post title=blog><i class="fas fa-rss"></i><span class=nav-name>blog</span></a></li><li class="nav-toggle music"><a href=/music title=music><i class="fas fa-music"></i><span class=nav-name>music</span></a></li><li class="nav-toggle poems"><a href=/post/poems title=poems><i class="fas fa-pen-nib"></i><span class=nav-name>poems</span></a></li><li class="nav-toggle doodles"><a href=/doodles title=doodles><i class="fas fa-paint-brush"></i><span class=nav-name>doodles</span></a></li><li class="nav-toggle things"><a href=/things title=things><i class="fas fa-object-ungroup"></i><span class=nav-name>things</span></a></li></ul></nav></div></div><div class=container><div id=main><h1>c hacking: polymorphing 2</h1><p class=timestamps>Created: December 2, 2015</p><div class=text-justify><p>While working on <a href=http://github.com/ryjen/cparse>cparse</a> I found another nifty way to sort of simulate polymorphism.</p><h1 id=cparse>cparse</h1><p>Another exercise in futility, a C implementation for the REST api at <a href=http://parse.com>parse.com</a>. Really the core of it is a web client and an object structure using json.</p><h1 id=polymorphing>polymorphing</h1><p>I started off by having separate structure for the different type of objects, but I quickly realized there was a lot of code duplication.
To solve this I used a combination of type defines and function pointers to the library API appear to be working with a seperate type, but are indeed still working with the base object type.</p><p>So for an example, I&rsquo;ll explain an object and user types.</p><h2 id=object>object</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>/* the alias */</span>
<span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> cparse_object cParseObject;

<span style=color:#75715e>/* the definition */</span>
<span style=color:#66d9ef>struct</span> cparse_object
{
	<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>objectId;
	cParseJson <span style=color:#f92672>*</span>attributes;
	<span style=color:#75715e>/* etc. */</span>
};

<span style=color:#75715e>/* functions to operate on objects */</span>

<span style=color:#66d9ef>bool</span> <span style=color:#a6e22e>cparse_object_save</span>(cParseObject <span style=color:#f92672>*</span>obj, cParseError <span style=color:#f92672>**</span>error);

<span style=color:#66d9ef>bool</span> <span style=color:#a6e22e>cparse_object_delete</span>(cParseObject <span style=color:#f92672>*</span>obj, cParseError <span style=color:#f92672>**</span>error);

<span style=color:#75715e>/* etc */</span>

</code></pre></div><h2 id=user>user</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>/* the alias: note that it is aliasing an object */</span>
<span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> cparse_object cParseUser;

<span style=color:#75715e>/* implementation of functions to operator on users: note that they point to object functions */</span>

<span style=color:#66d9ef>bool</span> (<span style=color:#f92672>*</span>cparse_user_save)(cParseUser <span style=color:#f92672>*</span>obj, cParseError <span style=color:#f92672>**</span>error) <span style=color:#f92672>=</span> cparse_object_save;

<span style=color:#66d9ef>bool</span> (<span style=color:#f92672>*</span>cparse_user_delete)(cParseUser <span style=color:#f92672>*</span>obj, cParseError <span style=color:#f92672>**</span>error) <span style=color:#f92672>=</span> cparse_object_delete;

<span style=color:#75715e>/* etc */</span>

</code></pre></div><h2 id=example-usage>example usage</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>
<span style=color:#75715e>/* example object */</span>
cParseObject <span style=color:#f92672>*</span>obj <span style=color:#f92672>=</span> cparse_object_new();

cparse_object_save(obj, <span style=color:#f92672>&amp;</span>error);


<span style=color:#75715e>/* example user */</span>
cParseUser <span style=color:#f92672>*</span>user <span style=color:#f92672>=</span> cparse_user_new();

cparse_user_save(user, <span style=color:#f92672>&amp;</span>error);

</code></pre></div><h2 id=conclusion>Conclusion</h2><p>As you can see from the example, the library API appears to be working with two distinct objects. Using JSON as an object structure allows the object type to be resused (aliased) into other types this way without worrying about its members. User objects can be passed directly to object functions as parameters without any issues.</p><p>Another benefit of this implementation is if the user object ever does become a distinct seperate object, the library API does not change or affect existing code!</p><p>Cheers!</p></div></div></div><hr><div class=container><div id=related><h5>Related:</h5><div class="card item bg-default clearfix"><p class=pull-right>November 30, 2012</p><h4><a href=/2012/11/30/poor-mans-polymorphism/>Poor Man's Polymorphism</a></h4><h5>c wierdness</h5><span class=item-tag>c</span> <span class=item-tag>polymorphism</span> <span class=item-tag>programming</span></div><div class="card item bg-default clearfix"><p class=pull-right>May 15, 2012</p><h4><a href=/2012/05/15/c-sqlite-tricks/>C Sqlite Tricks</a></h4><h5>database mapping</h5><span class=item-tag>c</span> <span class=item-tag>programming</span> <span class=item-tag>sqlite</span></div><div class="card item bg-default clearfix"><p class=pull-right>April 10, 2012</p><h4><a href=/2012/04/10/best-programming-quotes/>Best Programming Quotes</a></h4><h5>quotes used in software development</h5><span class=item-tag>development</span> <span class=item-tag>programming</span> <span class=item-tag>quotes</span> <span class=item-tag>software</span></div></div></div><hr><div class=container><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"arg3"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div id=footer><script data-goatcounter=https://analytics.micrantha.com/count async src=//analytics.micrantha.com/count.js></script><button id=themer class=center type=button>enlighten</button><div class="menu center"><ul><li><a href=mailto:robert@ryanjennin.gs><i class="fa-3x fas fa-envelope"></i></a></li><li><a href=https://micrantha.com><i class="fa-3x fas fa-building"></i></a></li><li><a href=https://github.com/ryjen><i class="fa-3x fab fa-github"></i></a></li><li><a href=https://linkedin.com/in/ryjen><i class="fa-3x fab fa-linkedin"></i></a></li></ul></div><div class=center>Â© all rights reserved, ryan jennings</div></div><script src=/js/theme.min.js></script><script src=/js/app.min.js></script><script data-goatcounter=https://analytics.micrantha.com/count async src=//analytics.micrantha.com/count.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>