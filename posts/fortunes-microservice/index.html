<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Fortunes on Slack</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=google-site-verification content="Crk6W-ckoApRrOZrv23ngLwPPTbzjzfZ4AQPElgS0pw"><meta name=description content="personal blog of an engineer, musician, and madman"><meta name=robots content="index, follow"><meta http-equiv=cache-control content="no-cache"><meta http-equiv=pragma content="no-cache"><meta http-equiv=expires content="0"><link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,900&family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap" rel=preload type=font/otf as=font><link rel=stylesheet href=/css/theme.min.css type=text/css as=style><link href=/css/app.min.css rel=stylesheet type=text/css as=style></head><body class=dark><header id=header class=shoulders><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=navbar-item href=/><figure class="image is-32x32 mr-3"><img class=is-rounded src=/image/logo-profile.png alt=logo></figure>ryan jennings</a>
<a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=#nav><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=nav class=navbar-menu><div class=navbar-end><a class=navbar-item href=/posts><span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#rss"/></svg></span>blog</a>
<a class=navbar-item href=/art><span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#icons"/></svg></span>art</a>
<a class=navbar-item href=/things><span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#object-ungroup"/></svg></span>things</a>
<a class=navbar-item href=/about><span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#info-circle"/></svg></span>about</a>
<a role=button class="navbar-item themer" href=#><span class="icon is-small"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#yin-yang"/></svg></span></a></div></div></div></nav></header><section id=main class=abdomen><nav class="breadcrumb ml-4 is-small" aria-label=breadcrumbs><ul><li><a href=/>Home</a></li><li><a href=/posts/>Blog</a></li><li class=is-active><a href=/posts/fortunes-microservice/>Fortunes on Slack</a></li></ul></nav><div class=container><h1 class=title>Fortunes on Slack</h1><div class=content><p><a href=https://fortunes.micrantha.com>view the service homepage</a></p><h4 id=introduction>Introduction</h4><p>Have always enjoyed the <a href=https://en.wikipedia.org/wiki/Fortune_%28Unix%29>UNIX fortunes</a> program, ever since I was a wee <a href=https://en.wikipedia.org/wiki/Newbie>newbie</a>. If you aren&rsquo;t familiar with it (sad), yes, its like a fortune cookie.</p><p>It can be more technical in nature but not always. It also has poems, quotations, and if enabled - offensive content.</p><p>Often I would find a fortune I&rsquo;d like to share and pipe it to a snippet from the terminal. There has to and must be a better way!</p><p>This time a Slack application has appeared on my radar as a target.</p><h4 id=man-the-sonar>Man the Sonar</h4><p>Cannot engage the target without some information.</p><p>The existing fortunes database will provide plenty of content. Fortunately (no pun intended), I&rsquo;ve already extracted the legacy flat file storage system into SQL for another project.</p><p><code>TODO: add conversion to SQL details</code></p><p>Had to make a few changes, a link table here, few fields there, but the gist is I have a PostgreSQL initialization script of fortunes.</p><h4 id=cut-me-some-slack>Cut me some Slack</h4><p>Got the data (got the life), how does Slack care?</p><p>The user enters a slash command and Slack will send a torpedo to my server by means of an HTTP JSON post.</p><p>My server will then typically counter measure with what they call an &ldquo;Ephemeral Message&rdquo;.</p><p>The counter measure will have an attachment to give an option to make the message visible to the current channel (by means of another torpedo and counter measure).</p><p><code>TODO: detail more the key parts, json and oauth</code></p><h4 id=alright-captain-tell-me-about-your-ship>Alright Captain, Tell me About Your Ship</h4><p>First, say &ldquo;I was born on a pirate ship&rdquo; 5 times fast. OK, never mind.</p><p>This is a story about a gopher and a whale in a secure proxy.</p><p>In other words, I&rsquo;m just running golang, in a docker container, behind NGINX with lets-encrypt.</p><p><img src=/image/blog/architecture.png alt="fortunes architecture"></p><h4 id=ok-what-if-a-torpedo-hits>OK, What if a Torpedo Hits?</h4><p>Yeah, I don&rsquo;t think the world will be falling over itself to use the fortunes service, but if they do, I will start charging to spin up more droplets and a load balancer.</p><p>As I&rsquo;m using docker, switching to AWS Fargate is possible too with a Docker Compose file.</p><h4 id=for-the-code-or-gopher-geeks>For the Code or Gopher Geeks</h4><p>As most gophers already know, the beauty of go besides its concurrency is its simplicity and its awesome packages.</p><p>For HTTP is you really don&rsquo;t need anything. The standard library is so simple yet so effective. Your endpoints become functions, your functions become routed to paths, and you serve. The standard template packages work great for layouts in the endpoint functions.</p><p>The server has two restful API&rsquo;s - the standard API and the Slack API. Both use the same process of serializing from the database to JSON by typical means of attributed data models.</p><p><code>TODO: add some code architecture details</code></p><h4 id=conclusion>Conclusion</h4><p>Random fortune cookies are fun. Slack is fun. Golang is awesome. Docker is pleasing.</p><p>Check out <a href=https://fortunes.micrantha.com>the final solution</a> page.</p><p><code>TODO: implement mobile apps</code></p></div></div></section><footer id=footer class=legs><div class="has-text-centered content"><div class="is-flex is-align-items-center is-justify-content-center"><div class="has-text-centered m-3"><button id=themer class=themer type=button>enlighten</button></div><a href=https://github.com/ryjen/ryjen.github.io/issues/new>See an issue?</a></div><div class=copyright>Â© all rights reserved, ryan jennings</div></div></footer><script src=/js/vendor.min.js defer></script><script src=/js/theme.min.js defer></script><script src=/js/app.min.js defer></script><script data-goatcounter=https://analytics.micrantha.com/count async src=//analytics.micrantha.com/count.js></script></body></html>