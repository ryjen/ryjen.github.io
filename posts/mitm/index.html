<!doctype html>
<html lang="en-us">
  <head>
    
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Man-in-the-Middle</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="google-site-verification" content="Crk6W-ckoApRrOZrv23ngLwPPTbzjzfZ4AQPElgS0pw" />
<meta name="description" content="personal blog of an engineer, musician, and madman" />
<meta name="robots" content="index, follow">
<meta http-equiv="Cache-Control" content="no-cache" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />


<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,900&family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap" rel="preload" type="font/otf" as="font">
<link rel="stylesheet" href="/css/theme.min.css" type="text/css" as="style">


<link href="/css/app.min.css" rel="stylesheet" type="text/css" as="style">



  </head>
  <body >
    <header id="header" class="shoulders">
      
        <nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">

    <a class="navbar-item" href="/">
      <figure class="image is-32x32 mr-3">
        <img class="is-rounded" src="/image/logo-profile.png" alt="logo">
      </figure>
      ryan jennings
    </a>

    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="#nav">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div id="nav" class="navbar-menu">
    
    <div class="navbar-end">
      












    
  <a class="navbar-item" href="/posts">
    <span class="icon is-small mr-3">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <use xlink:href="/fonts/solid.svg#rss"></use>
  </svg>
</span>
    blog
  </a>




    
  <a class="navbar-item" href="/art">
    <span class="icon is-small mr-3">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <use xlink:href="/fonts/solid.svg#icons"></use>
  </svg>
</span>
    art
  </a>




    
  <a class="navbar-item" href="/things">
    <span class="icon is-small mr-3">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <use xlink:href="/fonts/solid.svg#object-ungroup"></use>
  </svg>
</span>
    things
  </a>




    
  <a class="navbar-item" href="/about">
    <span class="icon is-small mr-3">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <use xlink:href="/fonts/solid.svg#info-circle"></use>
  </svg>
</span>
    about
  </a>




<a role="button" class="navbar-item themer" href="#">
  <span class="icon is-small">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <use xlink:href="/fonts/solid.svg#yin-yang"></use>
  </svg>
</span>
</a>



    </div>
    
  </div>
</div>
</nav>


      
    </header>

    <section id="main" class="abdomen">
      

  
<nav class="breadcrumb ml-4 is-small" aria-label="breadcrumbs">
  <ul>
    









<li>
    <a href="/">Home</a>
</li>




<li>
    <a href="/posts/">Blog</a>
</li>




<li class="is-active">
    <a href="/posts/mitm/">Man-in-the-Middle</a>
</li>


  </ul>
</nav>





  <div class="container">

  
  <h1 class="title">Man-in-the-Middle</h1>
  

  <div class="content">
    <p>A man-in-the-middle (MITM) attack is a network security attack where a malicious device enters a network and intercepts traffic between nodes or components.</p>
<p>To accomplish access to a network an attacker needs an entry point.<br>
There are many ways for a malicious device to accomplish access into a network.</p>
<ul>
<li>Public networks, secured or not</li>
<li>Social engineering into organization or internal networks</li>
<li>WIFI password cracking or guessing with <a href="https://en.wikipedia.org/wiki/Rainbow_table">rainbow tables</a></li>
<li>Rogue WIFI access point to trick auto-join</li>
</ul>
<p>Once a malicious device obtains access to a network there are many possible vulnerabilities to exploit.</p>
<ul>
<li>Sniffing authentication and session tokens</li>
<li>Address Resolution Protocol (ARP) spoofing</li>
<li>Domain Name Service (DNS) spoofing</li>
<li>HTTP(S) proxies</li>
<li>Network sniffing and probing</li>
<li>Routing packet proxy</li>
<li>TCP tunnel proxy</li>
<li>Injecting data or code addressed to other hosts</li>
<li>Redirecting HTTP(s) traffic</li>
<li>Stripping SSL certificates</li>
</ul>
<h2 id="example">Example</h2>
<p>Best way to simulate a network attack is with virtual machines.  Virtual hardware you can simulate attacks at any level of the TCP/IP stack while keeping your own network safe.</p>
<p>I have setup a <a href="https://github.com/ryjen/mitm">github project</a> using vagrant to setup the following virtual environment.</p>
<h4 id="attacker">Attacker</h4>
<p>A Linux (arch) virtual machine configured with</p>
<ul>
<li>kernel IP forwarding enabled</li>
<li><code>bettercap</code>, <code>nmap</code> and <code>ip</code> tools installed</li>
</ul>
<h4 id="victim">Victim</h4>
<p>A windows 10 virtual machine with a browser (IE).</p>
<h3 id="server">Server</h3>
<p>Another Linux virtual machine with a web server installed.</p>
<p>The web content is a login form and a landing page accessible in both HTTP and HTTPS.</p>
<h2 id="scenario">Scenario</h2>
<ol>
<li>The attacker scans the gateway (router) for IP addresses</li>
<li>The attacker scans a specific IP address for information to target</li>
<li>The attacker initiates bettercap configured to:
<ol>
<li>ARP spoof the victims IP</li>
<li>Start an HTTP proxy to inject a script</li>
<li>Setup SSL stripping by using HTTP if available</li>
<li>Sniff network traffic for exposed information like credentials</li>
</ol>
</li>
<li>The victim visits the server via HTTPS</li>
<li>The attacker injects a script</li>
<li>The victim logs into the server</li>
<li>The attacker strips SSL and reads the credentials</li>
</ol>
<h2 id="deeper-into-the-attack">Deeper into the Attack</h2>
<h3 id="internet-protocol-version-6">Internet Protocol Version 6</h3>
<p>IPv6 improves the vulnerabilities in Internet Control Message Protocol (ICMP) over IPv4 with some important changes.</p>
<ul>
<li>replacing ARP with the Neighbor Discovery Protocol (NDP)</li>
<li>introducing a secure extension to network discovery (SEND)</li>
<li>replacing Router Discovery (RDISC) with Multicast Listener/Router Discovery (MLD/MRD)</li>
</ul>
<p>New IPv6 specific MITM attacks have been found, such as the <a href="https://resources.infosecinstitute.com/topic/slaac-attack/">Stateless Address Auto Configuration (SLAAC) Attack</a> (appears to be a windows configuration issue that allows IP4 vulnerabilities).</p>
<h2 id="tcpip-model">TCP/IP Model</h2>
<p>Data packets at any layer can be modified with malicious information as if they were a part of the normal stream.</p>
<p>It is significantly more difficult to achieve the lower you go in the stack.</p>
<h3 id="network-layer">Network Layer</h3>
<p><a href="https://en.wikipedia.org/wiki/IPsec">IPSec</a> is a <strong>secure network protocol suite</strong> that protects <strong>end-to-end</strong> inside TCP packets.  It is most commonly deployed by Virtual Private Networks (VPN).</p>
<p><a href="https://en.wikipedia.org/wiki/Domain_Name_System_Security_Extensions">DNSSEC</a> is a set of <strong>extensions</strong> to <strong>encrypt DNS</strong> data.</p>
<p>Switching to an IPv6 only network will mitigate common vulnerabilities.</p>
<h3 id="transport-layer">Transport Layer</h3>
<p>TLS encryption is the main mitigation at this layer.</p>
<p>Closing or redirecting HTTP or other non-TLS ports will mitigate SSL stripping.</p>
<p>Certificate authorities and certificate pinning help mitigate spoofing.</p>
<h3 id="application-layer">Application Layer</h3>
<p>If an attacker reaches the application layer, the information stolen can allow
further vulnerabilities like <strong>session hijacking</strong>, <strong>Cross-site Request Forgery</strong> (CSRF), and accessing <strong>unauthorized data</strong>.</p>
<p>Mitigation strategies include:</p>
<ul>
<li>Applications and systems should be kept up to date and hardened</li>
<li>All network access points have strong authentication and authorization.</li>
<li>Sandboxing in virtual machines, containers, jails, chroot or with file permissions.</li>
<li>Follow other best-practices like <strong>security through obscurity</strong> and <strong>principle of least privilege</strong>.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Detection of an attack is difficult limited to tamper detection by testing and examining latency of messages or possibly machine learning from behaviours.</p>
<p>Forensic analysis of captured network traffic provides post-mortem detection, so <strong>observability</strong> in all aspects of your system is important.</p>
<p>That&rsquo;s all for now folks.</p>

  </div>

  



  



  </div>


    </section>

    <footer id="footer" class="legs">
      









<div class="has-text-centered content">

  <div class="is-flex is-align-items-center is-justify-content-center">
    
    <div class="has-text-centered m-3">
      <button id="themer" class="themer" type="button">enlighten</button>
    </div>
    <a href="https://github.com/ryjen/ryjen.github.io/issues/new">See an issue?</a> 
  </div>

  <div class="copyright">
  Â© all rights reserved, ryan jennings 
  </div>
</div>


    </footer>

    
<script src="/js/vendor.min.js" defer></script>
<script src="/js/theme.min.js" defer></script>


<script src="/js/app.min.js" defer></script>




<script data-goatcounter="https://analytics.micrantha.com/count"
        async src="//analytics.micrantha.com/count.js"></script>






  </body>
</html>
