<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Man-in-the-Middle</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="dark light"><meta name=google-site-verification content="Crk6W-ckoApRrOZrv23ngLwPPTbzjzfZ4AQPElgS0pw"><meta name=description content="personal blog of an engineer, musician, and madman"><meta name=robots content="index, follow"><link rel=stylesheet href=/css/theme.min.css?t=1652166839754 type=text/css><link href=/css/app.min.css?t=1652166839754 rel=stylesheet type=text/css></head><body class=letter><header id=header class=shoulders><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=navbar-item href=/><figure class="image is-32x32 mr-3"><img class=is-rounded src=/image/logo-profile.png alt=logo></figure>ryan jennings</a>
<a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=nav><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div id=nav class=navbar-menu><div class=navbar-end><a class=navbar-item href=/posts><span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#rss"/></svg></span>blog</a>
<a class=navbar-item href=/art><span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#icons"/></svg></span>art</a>
<a class=navbar-item href=/things><span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#object-ungroup"/></svg></span>things</a>
<a class=navbar-item href=/about><span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#info-circle"/></svg></span>about</a>
<a role=button class="navbar-item themer" href=#><span class="icon is-small"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#yin-yang"/></svg></span></a></div></div></nav></header><section id=main class=abdomen><nav class="breadcrumb ml-4 is-small" aria-label=breadcrumbs><ul><li><a href=/>Home</a></li><li><a href=/posts/>Blog</a></li><li class=is-active><a href=/posts/mitm/>Man-in-the-Middle</a></li></ul></nav><div class=container><h1 class=title>Man-in-the-Middle</h1><div class=content><p>A man-in-the-middle (MITM) attack is a network security attack where a malicious device enters a network and intercepts traffic between nodes or components.</p><p>To accomplish access to a network an attacker needs an entry point.<br>There are many ways for a malicious device to accomplish access into a network.</p><ul><li>Public networks, secured or not</li><li>Social engineering into organization or internal networks</li><li>WIFI password cracking or guessing with <a href=https://en.wikipedia.org/wiki/Rainbow_table>rainbow tables</a></li><li>Rogue WIFI access point to trick auto-join</li></ul><p>Once a malicious device obtains access to a network there are many possible vulnerabilities to exploit.</p><ul><li>Sniffing authentication and session tokens</li><li>Address Resolution Protocol (ARP) spoofing</li><li>Domain Name Service (DNS) spoofing</li><li>HTTP(S) proxies</li><li>Network sniffing and probing</li><li>Routing packet proxy</li><li>TCP tunnel proxy</li><li>Injecting data or code addressed to other hosts</li><li>Redirecting HTTP(s) traffic</li><li>Stripping SSL certificates</li></ul><h2 id=example>Example</h2><p>Best way to simulate a network attack is with virtual machines. Virtual hardware you can simulate attacks at any level of the TCP/IP stack while keeping your own network safe.</p><p>I have setup a <a href=https://github.com/ryjen/mitm>github project</a> using vagrant to setup the following virtual environment.</p><h4 id=attacker>Attacker</h4><p>A Linux (arch) virtual machine configured with</p><ul><li>kernel IP forwarding enabled</li><li><code>bettercap</code>, <code>nmap</code> and <code>ip</code> tools installed</li></ul><h4 id=victim>Victim</h4><p>A windows 10 virtual machine with a browser (IE).</p><h4 id=server>Server</h4><p>Another Linux virtual machine with a web server installed.</p><p>The web content is a login form and a landing page accessible in both HTTP and HTTPS.</p><h3 id=scenario>Scenario</h3><ol><li>The attacker scans the gateway (router) for IP addresses</li><li>The attacker scans a specific IP address for information to target</li><li>The attacker initiates bettercap configured to:<ol><li>ARP spoof the victims IP</li><li>Start an HTTP proxy to inject a script</li><li>Setup SSL stripping by using HTTP if available</li><li>Sniff network traffic for exposed information like credentials</li></ol></li><li>The victim visits the server via HTTPS</li><li>The attacker injects a script</li><li>The victim logs into the server</li><li>The attacker strips SSL and reads the credentials</li></ol><h2 id=deeper-into-the-attack>Deeper into the Attack</h2><p>Using the <a href=http://www.cellbiol.com/bioinformatics_web_development/wp-content/uploads/2017/01/tpc-ip-and-osi-model-cellbiol.com_.png>TCP/IP model</a> we can look at the vulnerabilities and mitigations.</p><p>Data packets at any layer can be modified with malicious information as if they were a part of the normal stream.</p><h4 id=network-layer>Network Layer</h4><p>Most vulnerabilities at this layer involve insecure protocols as manipulating a TCP packet in-stream is difficult to do:</p><ol><li>find the packet or a series of packets with the information you want (possibly decrypting)</li><li>manipulate the data</li><li>recalculate the checksums</li></ol><p><a href=https://en.wikipedia.org/wiki/IPsec>IPSec</a> is a <strong>secure network protocol suite</strong> that protects <strong>end-to-end</strong> inside TCP packets. It is most commonly deployed by Virtual Private Networks (VPN).</p><p><a href=https://en.wikipedia.org/wiki/Domain_Name_System_Security_Extensions>DNSSEC</a> is a set of <strong>extensions</strong> to <strong>encrypt DNS</strong> data.</p><h5 id=internet-protocol-version-6>Internet Protocol Version 6</h5><p>IPv6 improves the vulnerabilities in Internet Control Message Protocol (ICMP) over IPv4 with some important changes.</p><ul><li>replacing ARP with the Neighbor Discovery Protocol (NDP)</li><li>introducing a secure extension to network discovery (SEND)</li><li>replacing Router Discovery (RDISC) with Multicast Listener/Router Discovery (MLD/MRD)</li></ul><p>New IPv6 specific MITM attacks have been found, such as the <a href=https://resources.infosecinstitute.com/topic/slaac-attack/>Stateless Address Auto Configuration (SLAAC) Attack</a> (appears to be a windows configuration issue that allows IP4 vulnerabilities).</p><h4 id=transport-layer>Transport Layer</h4><p>TLS encryption is the main mitigation at this layer as a portal between the network and an application.</p><p>Closing or redirecting HTTP or other non-TLS ports will prevent SSL stripping.</p><p>Certificate authorities and certificate pinning help mitigate spoofing.</p><h4 id=application-layer>Application Layer</h4><p>If an attacker reaches the application layer, the information already stolen allows
further vulnerabilities like <a href=https://en.wikipedia.org/wiki/Session_hijacking>session hijacking</a>, <a href=https://en.wikipedia.org/wiki/Cross-site_request_forgery>Cross-site Request Forgery</a> (CSRF), <a href=https://en.wikipedia.org/wiki/SQL_injection>sql injection</a>, <a href=https://en.wikipedia.org/wiki/Denial-of-service_attack>denial of service</a> and accessing <strong>unauthorized data</strong>.</p><p>Mitigation strategies include:</p><ul><li>Applications and systems should be kept up to date and hardened.</li><li>All network access points have strong authentication and authorization.</li><li>Sandboxing in virtual machines, containers, jails, chroot or with file permissions.</li><li></li><li>Follow other best-practices like <strong>security through obscurity</strong> and <strong>principle of least privilege</strong>.</li></ul><h2 id=conclusion>Conclusion</h2><p>Detection of an attack is difficult limited to tamper detection by testing and examining latency of messages or possibly machine learning from behaviours.</p><p>Forensic analysis of captured network traffic provides post-mortem detection, so <strong>observability</strong> in all aspects of your system is important.</p><p>The industry still needs to move toward an IPv6 dominated internet to help prevent vulnerabilities at the network layer.</p><p>Especially with 5G mobile networks, as the technology is positioned for integration into IoT and other firmware devices that are not easily updated.</p><p>That&rsquo;s all for now folks.</p><hr><ul><li><a href=https://en.wikipedia.org/wiki/Man-in-the-middle_attack>Man-in-the-middle Attack</a></li><li><a href=https://www.commonlounge.com/discussion/2627e25558924f3fbb6e03f8f912a12d>Intro to Wireshark and Man in the Middle Attacks</a></li><li><a href=https://en.wikipedia.org/wiki/Interlock_protocol>Interlock Protocol</a></li><li><a href=http://www.worldcomp-proceedings.com/proc/p2011/SAM4991.pdf>mitm with wireshark analysis</a></li><li><a href=https://github.com/cloudflare/mitmengine>mitm engine</a></li><li><a href=https://caddyserver.com/>caddy</a></li><li><a href=https://hackerspace.kinja.com/how-to-defend-yourself-against-mitm-or-man-in-the-middl-1461796382>how to defend against mitm</a></li><li><a href=https://resources.infosecinstitute.com/topic/slaac-attack/>slaac - ipv6 vulnerability</a>- <a href=https://en.wikipedia.org/wiki/Man-in-the-middle_attack>Man-in-the-middle Attack</a></li><li><a href=https://resources.infosecinstitute.com/topic/slaac-attack/>SLAAC IPv6</a></li><li><a href=https://www.commonlounge.com/discussion/2627e25558924f3fbb6e03f8f912a12d>Intro to Wireshark and Man in the Middle Attacks</a></li><li><a href=https://en.wikipedia.org/wiki/Interlock_protocol>Interlock Protocol</a></li><li><a href=http://www.worldcomp-proceedings.com/proc/p2011/SAM4991.pdf>mitm with wireshark analysis</a></li><li><a href=https://github.com/cloudflare/mitmengine>mitm engine</a></li><li><a href=https://www.shodan.io/>security search engine</a></li><li><a href=https://github.com/bettercap/bettercap>bettercap</a></li><li><a href=https://blog.securityinnovation.com/blog/2011/06/how-to-test-for-man-in-the-middle-vulnerabilities.html>testing mitm vulnerabilities</a></li><li><a href=https://www.metasploit.com/>metasploit</a></li><li><a href=https://www.securew2.com/blog/best-tools-mitm-attacks/>mitm testing tools</a></li><li><a href="https://shop.hak5.org/products/wifi-pineapple?variant=81044992">wifi pineapple</a></li><li><a href=https://www.offensive-security.com/community-projects/>offensive security</a></li><li><a href=https://citizenlab.ca/category/research/tools-resources/>the citizen lab</a></li><li><a href=https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/intercepting-ssl-and-https-traffic-with-mitmproxy-and-sslsplit/>intercepting ssl and https</a></li><li><a href=https://testloop.co.uk/blog/2017/02/17/mitm-part-2/>testloop mitm setup</a></li><li><a href=https://www.kalitutorials.net/2016/12/bettercap-mitm-for-sniffing-traffic-and.html>bettercap for mitm</a></li><li><a href=https://zignar.net/2015/12/31/sniffing-vbox-traffic-mitmproxy/>vbox sniffing</a></li><li><a href=https://www.cyberpunk.rs/bettercap-usage-examples-overview-custom-setup-caplets>bettercap usage examples</a></li><li><a href=https://en.wikipedia.org/wiki/IPsec>IPSEC</a></li><li><a href=https://owasp.org/>OWASP</a></li><li><a href=https://en.wikipedia.org/wiki/Domain_Name_System_Security_Extensions>DNSSEC</a></li><li><a href=http://pubs.sciepub.com/iscf/7/1/1/index.html>lightweight mitm detection</a></li><li><a href=https://ryanjennin.gs/2020/09/18/blockchain-mesh-networks/>blockchain mesh networks</a></li><li><a href=https://www.researchgate.net/publication/330883530_Blockchain_A_Tale_of_Peer_to_Peer_Security>blockchain: a tale of peer-to-peer security</a></li><li><a href=https://cujo.com/ai-driven-network-security/>AI driven network security</a></li><li><a href="https://www.forbes.com/sites/louiscolumbus/2019/07/14/why-ai-is-the-future-of-cybersecurity/?sh=3e853ec5117e">Why AI is the future of network security</a></li><li><a href=https://www.comparitech.com/blog/information-security/5g-security-risks/>5G security risks</a></li></ul></div></div></section><footer id=footer class=legs><div class="has-text-centered content"><div class="is-flex is-align-items-center is-justify-content-center"><div class="has-text-centered m-3"><button id=themer class=themer type=button>enlighten</button></div><a href=https://github.com/ryjen/ryjen.github.io/issues/new>See an issue?</a></div><div class=copyright>© all rights reserved, ryan jennings</div></div></footer><script src=/js/theme.min.js?t=1652166839754 defer></script>
<script src=/js/app.min.js?t=1652166839754 defer></script>
<script>window.goatcounter={path:function(e){return location.host+e}}</script><script data-goatcounter=https://analytics.micrantha.com/count async src=//analytics.micrantha.com/count.js></script></body></html>