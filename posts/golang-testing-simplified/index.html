<!doctype html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>why golang</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="google-site-verification" content="Crk6W-ckoApRrOZrv23ngLwPPTbzjzfZ4AQPElgS0pw" />
<meta name="description" content="personal blog of an engineer, musician, and madman" />
<meta name="robots" content="index, follow">


<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,900&family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap" rel="preload" type="font/otf" as="font">
<link rel="stylesheet" href="/css/theme.min.css" type="text/css">


<link href="/css/app.min.css" rel="stylesheet" type="text/css">



  </head>
  <body >
    <header id="header" class="shoulders">
      
        <nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">

    <a class="navbar-item" href="/">
      <figure class="image is-32x32 mr-3">
        <img class="is-rounded" src="/image/logo-profile.png" alt="logo">
      </figure>
      ryan jennings
    </a>

    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="#nav">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div id="nav" class="navbar-menu">
    
    <div class="navbar-end">
      












    
  <a class="navbar-item" href="/posts">
    <span class="icon is-small mr-3">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <use xlink:href="/fonts/solid.svg#rss"></use>
  </svg>
</span>
    blog
  </a>




    
  <a class="navbar-item" href="/art">
    <span class="icon is-small mr-3">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <use xlink:href="/fonts/solid.svg#icons"></use>
  </svg>
</span>
    art
  </a>




    
  <a class="navbar-item" href="/things">
    <span class="icon is-small mr-3">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <use xlink:href="/fonts/solid.svg#object-ungroup"></use>
  </svg>
</span>
    things
  </a>




    
  <a class="navbar-item" href="/about">
    <span class="icon is-small mr-3">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <use xlink:href="/fonts/solid.svg#info-circle"></use>
  </svg>
</span>
    about
  </a>




<a role="button" class="navbar-item themer" href="#">
  <span class="icon is-small">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <use xlink:href="/fonts/solid.svg#yin-yang"></use>
  </svg>
</span>
</a>



    </div>
    
  </div>
</nav>


      
    </header>

    <section id="main" class="abdomen">
      

  
<nav class="breadcrumb ml-4 is-small" aria-label="breadcrumbs">
  <ul>
    









<li>
    <a href="/">Home</a>
</li>




<li>
    <a href="/posts/">Blog</a>
</li>




<li class="is-active">
    <a href="/posts/golang-testing-simplified/">Why Golang</a>
</li>


  </ul>
</nav>





  <div class="container">

  
  <h1 class="title">Why Golang</h1>
  

  <div class="content">
    <p>Have become a fan boy of <a href="https://golang.org">golang</a> as a replacement for my beloved C purely because it is so simplified, and thus a <strong>guru</strong> language to me.</p>
<p>As it stands now, I am somewhat burned out in the depths of a mid-life crisis and pandemic.  Do not have, or want, the memory capacity for anything more complex or verbose.</p>
<p>A language like go meets these soft skill requirements more than others:</p>
<ul>
<li>is not verbose</li>
<li>does not mix strict object oriented principles with other principles (functional, extensions)</li>
<li>implementations from different people are mostly consistent</li>
<li>sufficient tooling</li>
<li>efficient with no virtual machine or binary dependency</li>
<li>cross platform and C-compatible binaries</li>
<li>used in industry</li>
</ul>
<p><a href="">Rust</a> is a very close second only because it is more verbose and you have to master the borrow checker.
<a href="">Swift</a> suffers from implementation differences and the apple bias, but benefits from optimizations.
<a href="">C++</a> is hell if a person is not pragmatic enough to use wisely and strictly.</p>
<p>The rest of the languages are great in their own right but do not meet my needs.</p>
<p>Frontend work it is hard to avoid javascript for web.  For mobile languages are locked into swift/objc or java/kotlin. Cross-mobile frameworks are more common and to keep transferable with web, you might as well use a javascript one.</p>
<p>Possible modern language upgrade paths:</p>
<p>Legacy || Modern
&mdash; | &mdash;
C | Go
C++, Objc | Rust
Objc | Swift
Java | Kotlin, Scala, Clojure
Erlang | Elixir
VB | C#, F#
JS | TypeScript, Babel</p>
<p>A common problem with libraries and frameworks is <a href="https://en.wikipedia.org/wiki/Overchoice">overchoice</a>.  One does not need overchoice in the fundamental idiosyncrasies of a language.</p>
<p>That being said, wanted a closer look at some things.</p>
<h2 id="golang-testing-and-assertions">golang testing and assertions</h2>
<p>Will assume you are familiar with testing in go and the various frameworks.</p>
<h3 id="assertions">assertions</h3>
<p>In my experience, assertion frameworks in general are sometime overkill, or in other words are unnecessary verbose.</p>
<p>Methods like <strong>IsFalse()/IsTrue()</strong> or <strong>IsNil()/IsNotNil()</strong> are superfluous or could be reduced to a simple boolean if check.</p>
<p>Golang does not include an assertion framework.  That being said, writing repeated if conditions can still be tedious and a more fluent way may be desired.</p>
<p>In the spirit of simplicity, a fluent assertion can be reduced to a wrapper for a single boolean condition.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#007f7f">// +build test
</span><span style="color:#007f7f"></span>
<span style="color:#fff;font-weight:bold">package</span> assert

<span style="color:#007f7f">// Action for a condition
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">type</span> Action <span style="color:#fff;font-weight:bold">func</span>()

<span style="color:#007f7f">// Handler for a condition
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">type</span> Context <span style="color:#fff;font-weight:bold">struct</span> {
  <span style="color:#007f7f">// the context value if any
</span><span style="color:#007f7f"></span>  value <span style="color:#fff;font-weight:bold">string</span>
  <span style="color:#007f7f">// the condition to handle
</span><span style="color:#007f7f"></span>	condition <span style="color:#fff;font-weight:bold">bool</span>
}

<span style="color:#007f7f">// Then performs the action
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">func</span> (c Context) Then(action Action) {
  <span style="color:#007f7f">// Check the test condition...
</span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">if</span> c.condition {
    <span style="color:#007f7f">// and perform the action if needed.
</span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// typically a failure indication.
</span><span style="color:#007f7f"></span>		action()
	}
  <span style="color:#007f7f">// if the condition is not true the action is ignored
</span><span style="color:#007f7f"></span>}

<span style="color:#007f7f">// When tests a condition for an action
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">func</span> When(condition <span style="color:#fff;font-weight:bold">bool</span>) Handler {
	<span style="color:#fff;font-weight:bold">return</span> Handler{condition: condition}
}
</code></pre></div><p>Running an action for a failed boolean condition handles ~95% of unit testing.</p>
<p>Some examples:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#fff;font-weight:bold">func</span> TestLogic(t *testing.T) {
  err := performLogic()
  When(err != <span style="color:#fff;font-weight:bold">nil</span>).Do(t.Fail)
}
</code></pre></div><p>This test performs the logic functionality, when there is an error condition, the standard failure method is used.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#fff;font-weight:bold">func</span> TestLogicVerbose(t *testing.T) {
  err := performLogic()
  When(err != <span style="color:#fff;font-weight:bold">nil</span>).Do(<span style="color:#fff;font-weight:bold">func</span>() {
    t.Fatal(<span style="color:#0ff;font-weight:bold">&#34;performing logic failed:&#34;</span>, err.Error())
  })
}
</code></pre></div><p>In this example, when the logic functionality has an error condition, a custom action reports the failure with a message.</p>
<h2 id="resource-dependencies-and-cleanup">resource dependencies and cleanup</h2>
<p>In some tests there are dependencies on external resources such as a file system or a database.</p>
<p>Golang does not provide the junit style <strong>Before</strong> or <strong>After</strong> hooks like some testing frameworks.</p>
<p>Instead there is a <strong>Cleanup</strong> hook and the ability to <strong>run sub-tests</strong> from within a test to preserve state.</p>
<p>For example:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#fff;font-weight:bold">func</span> TestWrite(t *testing.T) {

  <span style="color:#007f7f">// the data to use for IO
</span><span style="color:#007f7f"></span>  expected := randomData()

  <span style="color:#007f7f">// register a cleanup after the test
</span><span style="color:#007f7f"></span>  t.Cleanup(<span style="color:#fff;font-weight:bold">func</span>() {
    <span style="color:#fff;font-weight:bold">if</span> err := storage.Remove(expected); err != <span style="color:#fff;font-weight:bold">nil</span> {
      <span style="color:#fff;font-weight:bold">panic</span>(err)
    }
  })

  <span style="color:#007f7f">// Write to storage
</span><span style="color:#007f7f"></span>  err := storage.Write(expected)
  When(err != <span style="color:#fff;font-weight:bold">nil</span>).Do(t.Fail)

  <span style="color:#007f7f">// Run a sub test to read data back
</span><span style="color:#007f7f"></span>  t.Run(<span style="color:#fff;font-weight:bold">func</span> (t *testing.T) {

    result, err := storage.Read()

    When(err != <span style="color:#fff;font-weight:bold">nil</span>).Do(t.Fail)
    When(result != expected).Do(t.Fail)
  })
}
</code></pre></div><p>In this example the test some data is generated to read/write and a cleanup hook is registered to remove it.</p>
<p>The unit test writes the data and runs a sub test to read it back, asserting failure on errors.</p>
<p>When the test and the sub-test have finished the cleanup hook will run and remove the resource.</p>
<h2 id="conclusion">conclusion</h2>
<p>So simple, so clean, so guru.  No fuss, no muss.</p>
<p>I am also a fan of <strong><a href="">behaviour driven development</a></strong> when it comes to unit testing</p>

  </div>

  



  



  </div>


    </section>

    <footer id="footer" class="legs">
      









<div class="has-text-centered content">

  <div class="is-flex is-align-items-center is-justify-content-center">
    
    <div class="has-text-centered m-3">
      <button id="themer" class="themer" type="button">enlighten</button>
    </div>
    <a href="https://github.com/ryjen/ryjen.github.io/issues/new">See an issue?</a> 
  </div>

  <div class="copyright">
  © all rights reserved, ryan jennings 
  </div>
</div>


    </footer>

    
<script src="/js/vendor.min.js" defer></script>
<script src="/js/theme.min.js" defer></script>


<script src="/js/app.min.js" defer></script>




<script data-goatcounter="https://analytics.micrantha.com/count"
        async src="//analytics.micrantha.com/count.js"></script>






  </body>
</html>
