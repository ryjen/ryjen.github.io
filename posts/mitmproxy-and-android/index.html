<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<title>Mitmproxy and Android</title>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=color-scheme content="dark light">
<meta name=google-site-verification content="Crk6W-ckoApRrOZrv23ngLwPPTbzjzfZ4AQPElgS0pw">
<meta name=description content="personal blog of an engineer, musician, and madman">
<meta name=robots content="index, follow">
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,900&family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap" rel=preload type=font/otf as=font>
<link rel=stylesheet href=/css/theme.min.css?t=1635924059142 type=text/css>
<link href=/css/app.min.css?t=1635924059142 rel=stylesheet type=text/css>
</head>
<body>
<header id=header class=shoulders>
<nav class=navbar role=navigation aria-label="main navigation">
<div class=navbar-brand>
<a class=navbar-item href=/>
<figure class="image is-32x32 mr-3">
<img class=is-rounded src=/image/logo-profile.png alt=logo>
</figure>
ryan jennings
</a>
<a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=#nav>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
</a>
</div>
<div id=nav class=navbar-menu>
<div class=navbar-end>
<a class=navbar-item href=/posts>
<span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#rss"/></svg>
</span>
blog
</a>
<a class=navbar-item href=/art>
<span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#icons"/></svg>
</span>
art
</a>
<a class=navbar-item href=/things>
<span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#object-ungroup"/></svg>
</span>
things
</a>
<a class=navbar-item href=/about>
<span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#info-circle"/></svg>
</span>
about
</a>
<a role=button class="navbar-item themer" href=#>
<span class="icon is-small"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#yin-yang"/></svg>
</span>
</a>
</div>
</div>
</nav>
</header>
<section id=main class=abdomen>
<nav class="breadcrumb ml-4 is-small" aria-label=breadcrumbs>
<ul>
<li>
<a href=/>Home</a>
</li>
<li>
<a href=/posts/>Blog</a>
</li>
<li class=is-active>
<a href=/posts/mitmproxy-and-android/>Mitmproxy and Android</a>
</li>
</ul>
</nav>
<div class=container>
<h1 class=title>Mitmproxy and Android</h1>
<div class=content>
<h2 id=introduction>Introduction</h2>
<p>Debugging network traffic for your app can be useful, and sometimes necessary if the data is not what is expected or inconsistent.</p>
<h2 id=the-proxy>The Proxy</h2>
<p>I prefer the open source proxy [mitmproxy](<a href=https://mitmproxy.org>https://mitmproxy.org</a> =300x203). Easy to install on OSX with <a href=https://brew.sh>homebrew</a>.</p>
<p><code>brew install mitmproxy</code></p>
<p>I&rsquo;ll leave it up to you to explore its greatness, I just wanna clarify the android setup.</p>
<h2 id=steps>Steps</h2>
<h3 id=1-mitmproxy>1) mitmproxy</h3>
<p>Choose a port (ex. 8888) and start the program: <code>mitmproxy -p 8888</code>:</p>
<p><img src=/image/blog/mitmproxy.png alt=mitmproxy></p>
<p>If you prefer a web interface <code>mitmweb</code>:</p>
<p><img src=/image/blog/mitmweb.png alt=mitmweb></p>
<h3 id=2-android>2) Android</h3>
<p>Find your local machine IP address, on OSX this can be found in network preferences. For example <code>192.168.1.55</code>.</p>
<p>Alternatively, find your public IP address on <a href=https://whatismyip.com>whatismyip.com</a>. For example <code>55.55.55.55</code>.</p>
<h4 id=21-emulator>2.1) Emulator</h4>
<p>a) Open the extended controls from the emulator.</p>
<p><img src=/image/blog/extended_controls.png alt="extended controls"></p>
<p>b) Go to Settings and click on the Proxy tab. Enter your IP address and a port. <img src=/image/blog/emulator_proxy.png alt="emulator proxy"></p>
<h4 id=22-device>2.2) Device</h4>
<p>Download a <a href="https://play.google.com/store/apps/details?id=org.proxydroid&hl=en">proxy app</a> and enter the same settings.</p>
<h4 id=23-certificates>2.3) Certificates</h4>
<p>a) Open the mitmproxy portal to download its HTTPS certificate: <code>https://mitm.it</code></p>
<p><img src=/image/blog/mitm_cert.png alt="mitm cert"></p>
<p>b) Download the Android certificate and install it. Name it whatever your want.</p>
<h2 id=gotcha>Gotcha</h2>
<p>Starting in Android N, <a href=https://android-developers.googleblog.com/2016/07/changes-to-trusted-certificate.html>user certificates are not used by default</a>. Your app will have to define a <a href=https://developer.android.com/training/articles/security-config>network configuration</a> to use the certificate.</p>
<p>Configuring this is possible only during debugging using the <code>debug-overrides</code> directive.</p>
<pre tabindex=0><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;network-security-config&gt;
    &lt;debug-overrides&gt;
        &lt;trust-anchors&gt;
            &lt;!-- Trust preinstalled CAs --&gt;
            &lt;certificates src=&quot;system&quot; /&gt;
            &lt;!-- Additionally trust user added CAs --&gt;
            &lt;certificates src=&quot;user&quot; /&gt;
        &lt;/trust-anchors&gt;
    &lt;/debug-overrides&gt;
&lt;/network-security-config&gt;
</code></pre>
</div>
</div>
</section>
<footer id=footer class=legs>
<div class="has-text-centered content">
<div class="is-flex is-align-items-center is-justify-content-center">
<div class="has-text-centered m-3">
<button id=themer class=themer type=button>enlighten</button>
</div>
<a href=https://github.com/ryjen/ryjen.github.io/issues/new>See an issue?</a>
</div>
<div class=copyright>
Â© all rights reserved, ryan jennings
</div>
</div>
</footer>
<script src=/js/vendor.min.js?t=1635924059142 defer></script>
<script src=/js/theme.min.js?t=1635924059142 defer></script>
<script src=/js/app.min.js?t=1635924059142 defer></script>
<script data-goatcounter=https://analytics.micrantha.com/count async src=//analytics.micrantha.com/count.js></script>
</body>
</html>