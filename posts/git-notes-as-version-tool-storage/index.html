<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Git Notes Storage</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="dark light"><meta name=google-site-verification content="Crk6W-ckoApRrOZrv23ngLwPPTbzjzfZ4AQPElgS0pw"><meta name=description content="personal blog of an engineer, musician, and madman"><meta name=robots content="index, follow"><link rel=stylesheet href=/css/theme.min.css?t=1652166839749 type=text/css><link href=/css/app.min.css?t=1652166839749 rel=stylesheet type=text/css></head><body class=letter><header id=header class=shoulders><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=navbar-item href=/><figure class="image is-32x32 mr-3"><img class=is-rounded src=/image/logo-profile.png alt=logo></figure>ryan jennings</a>
<a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=nav><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div id=nav class=navbar-menu><div class=navbar-end><a class=navbar-item href=/posts><span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#rss"/></svg></span>blog</a>
<a class=navbar-item href=/art><span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#icons"/></svg></span>art</a>
<a class=navbar-item href=/things><span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#object-ungroup"/></svg></span>things</a>
<a class=navbar-item href=/about><span class="icon is-small mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#info-circle"/></svg></span>about</a>
<a role=button class="navbar-item themer" href=#><span class="icon is-small"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use xlink:href="/fonts/solid.svg#yin-yang"/></svg></span></a></div></div></nav></header><section id=main class=abdomen><nav class="breadcrumb ml-4 is-small" aria-label=breadcrumbs><ul><li><a href=/>Home</a></li><li><a href=/posts/>Blog</a></li><li class=is-active><a href=/posts/git-notes-as-version-tool-storage/>Git Notes Storage</a></li></ul></nav><div class=container><h1 class=title>Git Notes Storage</h1><div class=content><p>Am working on a project build tool to make repeatable tasks for <a href=https://micrantha.com>Micrantha</a> projects easier.</p><p>A module of this tool is automatic versioning using <a href=https://semver.org/>semantic version</a>.</p><h2 id=the-versioning>The versioning</h2><p>The way I wanted the versioning to work is to have <strong>thresholds</strong> for when a version component auto-increments.</p><p>For example:</p><ul><li>A <strong>patch</strong> version will increment after <strong>300</strong> builds</li><li>A <strong>minor</strong> version will increment after <strong>100</strong> patch builds</li></ul><p>This use as a reminder to bump a version if there are breaking changes or if you need to do more design.</p><p>For every build, the build number is incremented, and thus potentially the rest of the version.</p><p>A question that arose, is where does one store a build number that:</p><ol><li>Changes often</li><li>Differentiates between users?</li></ol><h2 id=storing-a-build-number>Storing a build number</h2><p>My initial attempt was to store the build number as a hidden file in the project.</p><p>Which is fine and worked, but the sheer amount of foreseeable conflicts is enough to make anyone rethink that approach.</p><p>And really, why should build information exist in a source repository. A build is the action with the object, not the object.</p><h3 id=tags-attempt>Tags Attempt</h3><p>Storing release versions in <strong>git-tags</strong> is accepted practice.</p><p>It was conceivable that tags could also be used for a build number.</p><p>Experimenting a bit I tried tagging from a release tag with a build number under a prefix (like <strong>build/20</strong>).</p><p>But to retrieve the build number, one would have to rely on <strong>git-describe</strong> or a sorted tag list to pop from.</p><ol><li>I could not get git-describe to use the latest build tag</li><li>why do I need a list of tags for every build?</li></ol><p>In any case, it was not fruitful and I looked for alternatives.</p><h3 id=git-notes>Git Notes</h3><p>Using <a href=https://git-scm.com/docs/git-notes>git-notes</a> as a secondary storage method could better separate the building from the source.</p><p>There are some obvious advantages:</p><ol><li>Git notes can be created on a file in the repository (the project configuration file)</li><li>They are not pushed by default</li><li>They have separate merge strategies when conflicts occur</li></ol><p>This seems ideal. Might as well put notes with the current version on commits too with a hook.</p><p>To push the notes is a little ugly, put doable with an alias/subcommand or by configuration (part of the project init step).</p><p>As the build versions must be semi consistent and sequential, the note must be created on a reference that will not change.</p><h2 id=the-proto>The Proto</h2><p>A quick proto in my build tool now has different storage methods.</p><ol><li>The <strong>library</strong> or file system in users home path <strong>~/.local</strong></li><li>The <strong>repository</strong> or <strong>git-notes</strong></li></ol><p>If the repository storage will try to use build notes on the first commit. One could use release tags as well but I am not sure if there is a benefit to having more than one build note.</p><p>If there are no commits, then versioning switches back to the library.</p><p>And syncing between or specifying storage methods is possible.</p><h2 id=the-reality-and-todo>The Reality and TODO</h2><p>This is still pretty hacky and pointless.</p><p>I have not tested merge conflicts with git notes.</p><p>If they prove to be just as problematic as a file in the repository there is a backup plan:</p><ol><li>Have a note just for the build numbers in a line based record</li><li>Change the merge strategy to <strong>cat_sort_uniq</strong> to take the diff and sort removing duplicates</li><li>The build number is the last/first record</li><li>Reset/clear when the patch version increments</li></ol><p>Eventually will write some unit tests ðŸ¤¦ or hit a conflict between my machines and see.</p></div></div></section><footer id=footer class=legs><div class="has-text-centered content"><div class="is-flex is-align-items-center is-justify-content-center"><div class="has-text-centered m-3"><button id=themer class=themer type=button>enlighten</button></div><a href=https://github.com/ryjen/ryjen.github.io/issues/new>See an issue?</a></div><div class=copyright>Â© all rights reserved, ryan jennings</div></div></footer><script src=/js/theme.min.js?t=1652166839749 defer></script>
<script src=/js/app.min.js?t=1652166839749 defer></script>
<script>window.goatcounter={path:function(e){return location.host+e}}</script><script data-goatcounter=https://analytics.micrantha.com/count async src=//analytics.micrantha.com/count.js></script></body></html>